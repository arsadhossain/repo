---
 - hosts: webserver
   name: ec2 deployment using terraform and httpd setup using ansible
   gather_facts: True
#   become: true

   tasks:

   - name: Run command to check
     #command: ansible localhost -m shell -a "echo yes | terraform apply"
     command: echo yes | terraform apply
     register: Execution_result
     ignore_errors: True
     tags:
        - apply
     args:
        chdir: /home/ec2-user/ec2_provisioning

   - name: Run command to check
     command: ansible localhost -m shell -a "echo yes | terraform destroy"
     register: Execution_result
     ignore_errors: True
     tags:
        - destroy	
   - name: Install apache packages, ensure httpd is running, will update index.html with public IP.
     yum:
       name: httpd
       state: present
     service:
       name: httpd 
       state: started
     shell: somescript.sh >> somelog.txt
     tags:
       -webserver
